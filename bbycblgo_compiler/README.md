# bbyCOBOL Parser Performance Test

This project provides a Go-based tool for parsing bbyCOBOL files using ANTLR4. It includes functionalities for preprocessing COBOL code, parsing files sequentially or in parallel, and managing failed test cases.

## Files in this Project:

- `main.go`: The main entry point of the application. It handles command-line arguments using Cobra, loads configuration from `config.yaml`, and orchestrates the parsing process. It also includes commands for setting up the ANTLR environment.
- `preprocessing.go`: Contains the `preprocessCobolAdvanced` function, which implements COBOL-specific preprocessing logic to prepare source code for parsing. This includes handling fixed-format rules, continuation lines, and comments.
- `parser.go`: Houses the core ANTLR parsing logic. It defines `ParseResult` and `CustomErrorListener` types, the `parseFileCobol` function for individual file parsing, and `runSequential` and `runParallel` functions for executing tests.
- `config.yaml`: A YAML configuration file that defines various parameters for the application, such as the maximum number of tests to run, directories for test files and failed tests, file extension, and the default run mode (sequential or parallel).
- `bbyCBL.g4`: The ANTLR4 grammar file for bbyCOBOL. This file defines the syntax rules for the COBOL language that the parser will recognize.
- `antlr-4.13.1-complete.jar`: The ANTLR4 runtime JAR file, used for generating the Go parser code from the grammar file. This file is downloaded by the `setup` command.
- `parser/`: This directory will contain the Go parser code generated by ANTLR4 from `bbyCBL.g4`.

## Usage:

To use this tool, you'll typically follow these steps:

1.  **Build the application, download antlr JAR, and generate the parser code:**

* `make build`

```
A parser for COBOL files, with options for running tests, and managing failed tests.

Usage:
  bbycblgo [flags]
  bbycblgo [command]

Available Commands:
  ast         Parse COBOL file(s) and print the AST
  clear       Clear the failed tests directory
  compile     Compile COBOL file(s)
  failed      Run only previously failed tests
  help        Help about any command
  setup       Downloads ANTLR JAR and generates parser code
  test        Run all tests

Flags:
      --fileext string   Test file extension (default ".baby")
  -h, --help             help for bbycblgo
  -n, --maxfiles int     Set to 0 for all files (default 10000)
      --runmode string   Run mode: sequential or parallel (default "parallel")

Use "bbycblgo [command] --help" for more information about a command.
```


2.  **Commands:**

    *   **Run all tests:**

        ```bash
        ./bbycblgo test
        ```

        *   Flags for `test` command:
            *   `--testdir string`: Directory with test files (default `../tests/recombined_formatted/`)
            *   `-p, --printpassed`: Print passed test cases

    *   **Run only previously failed tests:**

        ```bash
        ./bbycblgo failed
        ```

        *   Flags for `failed` command:
            *   `--faileddir string`: Directory for failed tests (default `../tests/failed/`)
            *   `-d, --hideverbose`: Hide verbose output for failed tests

    *   **Clear the failed tests directory:**

        ```bash
        ./bbycblgo clear
        ```

        *   Flags for `clear` command:
            *   `--faileddir string`: Directory for failed tests (default `../tests/failed/`)

    *   **Parse COBOL file(s) and print the AST:**

        ```bash
        ./bbycblgo ast [file/directory]
        ```

    *   **Compile COBOL file(s):**

        ```bash
        ./bbycblgo compile [file/directory]
        ```

        *   Flags for `compile` command:
            *   `-v, --verbose`: Enable verbose output

## Global Flags:

These flags can be used with any command:

*   `--fileext string`: Test file extension (default ".baby")
*   `-n, --maxfiles int`: Set to 0 for all files (default 10000)
*   `--runmode string`: Run mode: sequential or parallel (default "parallel")

## Configuration:

Edit `config.yaml` to change default parameters:

```yaml
maxfiles: 10000
fileext: ".baby"
runmode: "parallel"
```

Command-line flags will override these values.

## bbyCOBOL Parser (`bbyCBL.g4`):

If you need to modify the bbyCOBOL grammar, edit `bbyCBL.g4` and then run `./bbycblgo setup` again to regenerate the parser code in the `parser/` directory.
